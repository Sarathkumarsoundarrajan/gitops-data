@Library('gitops-data') _  // Ensure the shared library is configured in Jenkins

pipeline {
    agent any

    parameters {
        string(name: 'ENVIRONMENT', defaultValue: 'dev', description: 'Deployment environment')
    }

    environment {
        PROJECT_SCM_URL = "https://github.com/Sarathkumarsoundarrajan/chd-portal.git"
        GITOPS_DATA_PROJECT_PATH = "chd/portal-react-cavinkare"
        PROJECT_NAME = util_extractProjectNameFromGitUrl(PROJECT_SCM_URL) // Ensure this function exists in the shared library
        ANGULAR_VERSION = "12"
        NODE_IMAGE = "node:18-alpine"
        SONAR_ENVIRONMENTS = "dev"
        ENABLE_SONAR = "false"
        ENABLE_SONAR_QUALITY_GATE = "false"
    }

    stages {
        stage('Initialize') {
            steps {
                script {
                    echo "Running in environment: ${params.ENVIRONMENT}"

                    // Convert string values to boolean
                    def sonarEnabled = ENABLE_SONAR.toBoolean()
                    def sonarQualityGateEnabled = ENABLE_SONAR_QUALITY_GATE.toBoolean()

                    // Call the shared library function
                    template_angular(
                        PROJECT_SCM_URL,
                        PROJECT_NAME,
                        GITOPS_DATA_PROJECT_PATH,
                        ANGULAR_VERSION,
                        NODE_IMAGE,
                        sonarEnabled,
                        sonarQualityGateEnabled,
                        [SONAR_ENVIRONMENTS]
                    )
                }
            }
        }
    }
}
